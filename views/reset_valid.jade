extends ./layout

block content
  div.home-bg
    div.row
      div.small-6.small-centered.column.home__box
        img.home__brand(src='/img/poker-dots.png')
        form#Reset
          div.row
            div.small-12.column
              div.row.collapse
                div.small-9.column
                  input#Password(name='password' type='password' required placeholder='New password')
                div.small-3.column
                  button.postfix Reset
              input#Username(name='username' type='hidden' value='#{profile.username}')

  script(type='text/javascript').
    $(document).ready(function() {
      $('#Reset').find('input').blur(function() {
        var name = $(this).attr('name');
        var value = $(this).val();
        var $el = $(this);

        $.ajax({
          type: 'GET',
          url: '/signup/check-' + name,
          data: {
            value: value
          },
        })
        .done(function(data) {
          if(data.errors.length > 0) {
            showErrors($('#Reset'), data.errors);
          }
          else {
            $el.closest('.error').removeClass('error');
            $el.siblings('.error').remove();
          }
        });
      });

      $('#Reset').on('submit', function(event) {
        event.preventDefault();
        data = formToJSON($(this));
        $.ajax({
          type: 'POST',
          url: '/reset',
          data: {
            data: data
          }
        })
        .done(function(data) {
          if(data.errors.length == 0) {
            window.location.href = '/';
          }
          else{
            showErrors($('#Reset'), data.errors);
          }
        });
      });
    });

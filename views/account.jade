extends ./layout

block content
  div.row
    div.small-12.column
      h1 Account Placeholder
      p Current Balance is: <span id='Balance'>#{chips}</span>
      button(class='btn', id='Topup') Top Up Balance (2000)
  div.row
    div.small-12.column
      div#Graph
  
  script(type='text/javascript').  
    $(document).ready(function() {
      chart = new Highcharts.Chart({
        chart: {
          renderTo: 'container',
          defaultSeriesType: 'spline',
          events: {
            load: requestData
          }
        },
        credits: {
          enabled: false
        },
        exporting: {
          enabled: false
        },
        title: {
          text: 'Overall lifetime profitability',
          x: -20
        },
        yAxis: {
          title: {
            text: 'Profitability'
          }
        },
        xAxis: {
          title: {
            text: 'Time Played'
          },
          dateTimeLabelFormats: {
            month: '%e. %b',
            year: '%b'
          }
        },
        series: [{
            name: 'Profitability',
            data: []
        }]
      });
      $('#Topup').on('click', function() {
        $.ajax( {
          type: 'POST',
          url: '/account/topup-chips',
          data: {
            element: document.getElementById('sessionID')
          },
          success: function(data) {
            $('#Balance').text(data.chips);
          },
          error: function(e) {
            console.log(e.message);
          }
        });
        return false;
      });
    });
    function requestData() {
      $.ajax({
        url: '/account/profitability',
        success: function(data) {
          var mySeries = [];
          for (var i = 0; i < data.length; i++) {
            mySeries.push([data[i], data[i + 1]]);
            i++
          }
          var chart = $('#container').highcharts();
          chart.series[0].setData(mySeries);   
        },
        cache: false
    });
}